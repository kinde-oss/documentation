---
import type {Props} from "@astrojs/starlight/props";
import Default from "@astrojs/starlight/components/Head.astro";
import config from "virtual:starlight/user-config";

const hasCustomOGImage = Astro.props.entry.data.head.find((t) =>
  t.attrs.property === "og:image" ? true : false
);
---

{
  import.meta.env.PUBLIC_IS_ANALYTICS_ENABLED === "true" && (
    <script data-domain="kinde.com" src="https://kinde.com/js/script.tagged-events.js" defer />
  )
}

<script is:inline>
  document.addEventListener("DOMContentLoaded", function () {
    const sidebarNav = document.querySelector(".sidebar-pane");

    // Restore scroll position
    if (localStorage.getItem("navScrollPosition")) {
      sidebarNav.scrollTop = localStorage.getItem("navScrollPosition");
    }

    // Save scroll position before the page unloads
    window.addEventListener("beforeunload", function () {
      localStorage.setItem("navScrollPosition", sidebarNav.scrollTop);
    });
  });
</script>

<Default {...Astro.props}>
  <slot />
</Default>

{!hasCustomOGImage && <meta property="og:image" content={`${Astro.url.href}og-image.png`} />}

<link
  rel="preconnect"
  href=`https://${import.meta.env.PUBLIC_ALGOLIA_APP_ID}-dsn.algolia.net`
  crossorigin
/>
