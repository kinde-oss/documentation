---
page_id: e7809c64-99c7-4640-b7d1-c22b35ed3222
title: Deploy a Kinde app on Cloudflare Workers
description: Deploy your Next.js application with Kinde authentication to Cloudflare Workers using OpenNext or similar adapters with proper environment configuration and authentication patterns.
sidebar:
  order: 3
relatedArticles:
  - 3a5cbe42-d4c2-4f41-a243-a4852fdcf4a5
  - 5905adbb-296e-41ed-ad14-73eb986eeca7
  - 7d311fcf-ca33-49ec-9286-419da4a91f41
  - a07f8f6b-5d6a-4096-be52-7b13b4a3b0a5
  - b3081ca1-2aa1-45e3-a42f-5295aac49bc3
topics:
  - developer-tools
  - guides
  - deployment
  - cloudflare
sdk:
  - nextjs-sdk
languages:
  - typescript
  - javascript
  - bash
audience:
  - developers
complexity: intermediate
keywords:
  - Cloudflare Workers deployment
  - Next.js deployment
  - environment variables
  - wrangler
  - opennext
  - edge runtime
  - callback URLs
updated: 2026-02-06
featured: false
deprecated: false
ai_summary: Deploy your Next.js application with Kinde authentication to Cloudflare Workers using OpenNext or similar adapters with proper environment configuration and authentication patterns.
---

Cloudflare Workers provide a serverless edge runtime for deploying Next.js applications. This guide covers the specific configuration required to get Kinde authentication working correctly in this environment.

<Aside type="warning" title="Important">

Cloudflare Workers have a different runtime environment than traditional Node.js servers. Some configurations that work on Vercel or standard Node.js deployments require adjustments for Cloudflare.

</Aside>

### What you need

- A [Kinde](https://www.kinde.com/) account (sign up for free)
- A [Cloudflare](https://www.cloudflare.com/) account (sign up for free)
- A running [Next.js application](/developer-tools/sdks/backend/nextjs-sdk/) configured with Kinde
- [Node.js](https://nodejs.org/) version 20 or higher

## Key differences for Cloudflare Workers

Before diving into setup, understand these critical differences when deploying Kinde auth to Cloudflare Workers:

| Consideration | Standard deployment | Cloudflare Workers |
| --- | --- | --- |
| Environment variables | `.env.local` or platform UI | Must be in `wrangler.toml` `[vars]` section |
| `process.env` access | Works by default | Requires `nodejs_compat_populate_process_env` flag |
| KindeProvider | Can be used in providers | Avoid for SSR - use server-side auth patterns |

## Step 1: Configure Cloudflare Workers in your existing project

1. Open your project in a terminal and install the OpenNext.js adapter for Cloudflare Workers with the following command:

    ```bash
    npm install @opennextjs/cloudflare@latest
    ```

2. Install Wrangler CLI as a dev dependency:

    ```bash
    npm i -D wrangler@latest
    ```

3. Create a new file called `wrangler.toml` in the root of your project and add the following content:

    ```bash
    touch wrangler.toml
    ```

    ```toml
    # wrangler.toml
    "$schema" = "./node_modules/wrangler/config-schema.json"
    main = ".open-next/worker.js"
    name = "my-app"
    compatibility_date = "2026-02-06"
    compatibility_flags = [ "nodejs_compat", "nodejs_compat_populate_process_env"]

    [assets]
    directory = ".open-next/assets"
    binding = "ASSETS"
    ```

4. Update your `package.json` to include the following scripts:

    ```json
    // package.json
    "scripts": {
      ...your other scripts...
      "preview": "opennextjs-cloudflare build && opennextjs-cloudflare preview",
      "deploy": "opennextjs-cloudflare build && opennextjs-cloudflare deploy",
      "cf-typegen": "wrangler types --env-interface CloudflareEnv cloudflare-env.d.ts",
    }
    ```

5. Preview your project in the Cloudflare environment using the following command:

    ```bash
    npm run preview
    ```

## Step 2: Deploy your project to Cloudflare Workers

1. Authorize Wrangler to access your Cloudflare account using the following command:

    ```bash
    wrangler login
    ```

    This will open your default web browser, prompting you to log in to your Cloudflare account and authorize Wrangler. Once logged in, you’ll see a confirmation page.

2. Deploy your project to Cloudflare Workers using the following command:

    ```bash
    npm run deploy
    ```

    This will deploy your project to Cloudflare Workers. You’ll get a link to see the changes.

    ```bash
    https://<your-app-name>.<your-account-name>.workers.dev
    ```

3. Verify your deployment by visiting the URL you got from the previous command.

    ```bash
    https://<your-app-name>.<your-account-name>.workers.dev/api/auth/health
    ```

    Here you should see `localhost:3000` as the `KINDE_SITE_URL`. We will update this in the next step.

## Step 3: Add Kinde env variables and redeploy

1. In your Kinde dashboard, go to your application > **Details** and add the following URLs: 

    - **Allowed callback URLs**: `https://your_app_name.your_account_name.workers.dev/api/auth/kinde_callback`
    - **Allowed logout redirect URLs**: `https://your_app_name.your_account_name.workers.dev`

    Select **Save**

2. Update your `wrangler.toml` to include the following variables. You can get these from your Kinde application's **Quick start** page.

    ```toml
    # wrangler.toml
    # ...your existing config...
    [vars]
    KINDE_CLIENT_ID = "your_client_id"
    KINDE_CLIENT_SECRET = "your_client_secret"
    KINDE_ISSUER_URL = "https://your_business.kinde.com"
    KINDE_SITE_URL = "https://your_app_name.your_account_name.workers.dev"
    KINDE_POST_LOGIN_REDIRECT_URL = "https://your_app_name.your_account_name.workers.dev/dashboard"
    KINDE_POST_LOGOUT_REDIRECT_URL = "https://your_app_name.your_account_name.workers.dev"
    ```

3. Redeploy your project to Cloudflare Workers using the following command:

    ```bash
    npm run deploy
    ```

4. Verify your deployment by visiting your app in the browser. Sign in or sign up with Kinde and you should be redirected to the dashboard page.

## Configure authentication patterns

### Avoid KindeProvider in App Router for Cloudflare Workers

The `KindeProvider` component from `@kinde-oss/kinde-auth-nextjs` is designed for client-side context. When used in App Router's server-side rendering on Cloudflare Workers, it can cause SSR failures resulting in blank pages (200 OK with empty body).

**Don't do this** for Cloudflare Workers deployments:

```tsx
// app/providers.tsx - This pattern can cause issues on Cloudflare Workers
"use client";

import { KindeProvider } from "@kinde-oss/kinde-auth-nextjs";

export const AuthProvider = ({children}) => {
  return <KindeProvider>{children}</KindeProvider>;
};
```

### Use server-side authentication instead

The Next.js App Router SDK already handles authentication server-side through:

1. **Middleware** - The `withAuth` wrapper protects routes
2. **Server components** - Use `getKindeServerSession` for auth data
3. **API routes** - The `/api/auth/[kindeAuth]` route handles the auth flow

This is the recommended pattern for Cloudflare Workers:

```tsx
// middleware.ts
import { withAuth } from "@kinde-oss/kinde-auth-nextjs/middleware";

export default withAuth(
  async function middleware(req) {
    // Your middleware logic
  },
  {
    publicPaths: ["/", "/about"],
  }
);

export const config = {
  matcher: [
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
  ],
};
```

```tsx
// app/dashboard/page.tsx - Server component
import { getKindeServerSession } from "@kinde-oss/kinde-auth-nextjs/server";
import { redirect } from "next/navigation";

export default async function Dashboard() {
  const { isAuthenticated, getUser } = getKindeServerSession();

  if (!(await isAuthenticated())) {
    redirect("/api/auth/login");
  }

  const user = await getUser();

  return (
    <div>
      <h1>Welcome, {user?.given_name}</h1>
    </div>
  );
}
```

### Client-side auth data

If you need auth data in client components, fetch it from a server component and pass it down as props, or use a lightweight client-side check after the initial server render:

```tsx
// app/dashboard/page.tsx
import { getKindeServerSession } from "@kinde-oss/kinde-auth-nextjs/server";
import { DashboardClient } from "./DashboardClient";

export default async function Dashboard() {
  const { getUser, getPermissions } = getKindeServerSession();

  const user = await getUser();
  const permissions = await getPermissions();

  return <DashboardClient user={user} permissions={permissions} />;
}
```

```tsx
// app/dashboard/DashboardClient.tsx
"use client";

export function DashboardClient({ user, permissions }) {
  // Use the server-fetched data
  return <div>Hello {user?.given_name}</div>;
}
```

## Complete wrangler.toml example

Here's a complete example configuration:

```toml
name = "my-nextjs-kinde-app"
main = ".open-next/worker.js"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat", "nodejs_compat_populate_process_env"]

# Assets configuration (adjust based on your setup)
assets = { directory = ".open-next/assets", binding = "ASSETS" }

[vars]
KINDE_CLIENT_ID = "your_client_id_here"
KINDE_CLIENT_SECRET = "your_client_secret_here"
KINDE_ISSUER_URL = "https://yourbusiness.kinde.com"
KINDE_SITE_URL = "https://your-app.your-domain.workers.dev"
KINDE_POST_LOGIN_REDIRECT_URL = "https://your-app.your-domain.workers.dev/dashboard"
KINDE_POST_LOGOUT_REDIRECT_URL = "https://your-app.your-domain.workers.dev"
```

## Troubleshooting

### Blank white screen after deployment

**Symptom:** The server returns 200 OK but the HTML body is empty.

**Cause:** Usually caused by `KindeProvider` being used in a way that breaks SSR on Cloudflare Workers.

**Solution:** Remove `KindeProvider` from your providers and rely on server-side authentication patterns instead. See [Configure authentication patterns](#configure-authentication-patterns) above.

### Login redirects to localhost

**Symptom:** Clicking login redirects to `localhost:3000` instead of your Kinde domain.

**Cause:** Environment variables are not being read correctly. The SDK falls back to development defaults when it can't find the configuration.

**Solution:**

1. Ensure `nodejs_compat_populate_process_env` is in your `compatibility_flags`
2. Add all Kinde environment variables to the `[vars]` section of `wrangler.toml`
3. Redeploy your application

### "State not found" error

**Symptom:** After authenticating with Kinde, you're redirected back with a "state not found" error.

**Cause:** The authentication state cookie isn't being persisted correctly between the redirect.

**Solution:**

- Ensure your `KINDE_SITE_URL` exactly matches the URL you're accessing the app from
- Check that cookies are being set correctly in your Cloudflare Workers configuration
- If using a custom domain, ensure it's properly configured in both Cloudflare and Kinde

### Environment variables undefined in production

**Symptom:** Auth works locally but fails in production with undefined configuration errors.

**Cause:** Cloudflare Dashboard environment variables aren't automatically available via `process.env`.

**Solution:** Environment variables must be defined in `wrangler.toml` for the SDK to access them. The Cloudflare Dashboard variables are available as Worker bindings but not through `process.env` without the compatibility flag.

## Verify your configuration

After deploying, you can verify your Kinde configuration by visiting:

```
https://your-app-url.com/api/auth/health
```

This endpoint will show your SDK configuration (with secrets redacted) to help debug any issues.

## Related resources

- [Next.js App Router SDK](/developer-tools/sdks/backend/nextjs-sdk/)
- [Deploy an app on Vercel](/developer-tools/guides/deploy-on-vercel/)
- [Deploy a Kinde App on Netlify](/developer-tools/guides/deploy-on-netlify/)
- [Kinde and edge worker services](/integrate/third-party-tools/kinde-edge-workers/)
- [Set callback and redirect URLs](/get-started/connect/callback-urls/)
- [Cloudflare Workers documentation](https://developers.cloudflare.com/workers/)

Cloudflare Next.js documentation: https://developers.cloudflare.com/workers/framework-guides/web-apps/nextjs/ 

