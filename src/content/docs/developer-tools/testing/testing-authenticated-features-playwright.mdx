---
page_id: f38ed786-7234-44d1-a564-f7269ce536c5
title: Testing authenticated features with Playwright
description: "Comprehensive guide to testing authenticated features using Playwright, including reusing authentication state, CI/CD integration, and handling passwordless flows."
sidebar:
  order: 6
relatedArticles:
  - 4882de7b-07f3-4cc8-ac01-b096e17dcc35
  - c1b1ea81-35f9-467e-8079-042d6a786e55
  - a1b2c3d4-e5f6-7890-abcd-ef1234567890
topics:
  - developer-tools
  - testing
  - playwright
  - e2e-testing
  - authenticated-testing
sdk: []
languages:
  - JavaScript
  - TypeScript
audience: developers
complexity: intermediate
keywords:
  - Playwright
  - authenticated testing
  - e2e testing
  - test automation
  - CI/CD
  - authentication state
  - Mailosaur
updated: 2026-01-04
featured: false
deprecated: false
ai_summary: Comprehensive guide to testing authenticated features using Playwright, including reusing authentication state, CI/CD integration, and handling passwordless flows.
---

Learn how to efficiently test authenticated features in applications using Kinde authentication with Playwright.

There are two main approaches covered here:

1. **Reusing Authentication State** – Save auth state once and reuse across tests (recommended for most cases)
2. **API Testing with Token Refresh** – Test backend APIs without browser automation

We recommend using stored authentication state for most tests, and validating the actual login flow in dedicated auth tests.

### What you need

- A [test user with email and password](/developer-tools/testing/setup-test-user-environment/).
- A [running test application](/developer-tools/testing/setup-test-user-environment/#step-3-create-a-test-application) for testing locally.
- [Node.js](https://nodejs.org/en/download/) version 20 or higher.

## Setup a Playwright project

1. Install Playwright with the following command:
    ```bash
    npm init playwright@latest
    ```
2. Install dotenv with the following command:
    ```bash
    npm install dotenv --save-dev
    ```
3. Create a new `.env` file:
    ```bash
    touch .env
    ```
4. Add the following to the `.env` file:
    ```env
    TEST_APP_URL=https://your-app-url.com
    TEST_USER_EMAIL=test@example.com
    TEST_USER_PASSWORD=your-test-password
    ```

    <Aside type="warning" title="Important">
      Make sure to add the `.env` file to your `.gitignore` file to prevent committing sensitive information to source control.
    </Aside>

## Approach 1: Reusing Authentication State (Recommended)

Playwright supports saving and reusing browser authentication state. This is the most efficient approach for most test suites. Follow the steps below:

1. Edit the `playwright.config.ts` file to add the following:

    ```tsx
    // playwright.config.ts
    import { defineConfig, devices } from '@playwright/test';
    import * as dotenv from 'dotenv';

    dotenv.config();

    export default defineConfig({
      testDir: './tests',
      fullyParallel: true,
      forbidOnly: !!process.env.CI,
      retries: process.env.CI ? 2 : 0,
      workers: process.env.CI ? 1 : undefined,
      reporter: 'html',

      use: {
        baseURL: process.env.TEST_APP_URL,
        trace: 'on-first-retry',
      },

      projects: [
        // Setup project - authenticates and saves state
        {
          name: 'setup',
          testMatch: /.*\.setup\.ts/,
        },

        // Main tests - use saved auth state
        {
          name: 'chromium',
          use: {
            ...devices['Desktop Chrome'],
            storageState: 'playwright/.auth/user.json',
          },
          dependencies: ['setup'],
        },
      ],
    });
    ```

2. Create an `auth.setup.ts` file and add the following:
    ```tsx
    // tests/auth.setup.ts
    import { test as setup, expect } from '@playwright/test';

    const authFile = 'playwright/.auth/user.json';

    setup('authenticate', async ({ page, baseURL }) => {
      // Navigate to your app's login page
      await page.goto(baseURL!);

      // Click sign in (this redirects to Kinde)
      await page.click('[data-testid="sign-in-button"]');

      // Wait for Kinde login page
      await page.waitForURL(/.*kinde\.com.*/);

      // Enter email
      await page.fill('input[name="p_email"]', process.env.TEST_USER_EMAIL!);
      await page.click('button[type="submit"]');

      // Enter password
      await page.fill('input[name="p_password"]', process.env.TEST_USER_PASSWORD!);
      await page.click('button[type="submit"]');

      // Wait for redirect back to your app
      await page.waitForURL(new RegExp(`^${baseURL}/.*`));

      // Verify authentication succeeded
      await expect(page.locator('[data-testid="user-profile"]')).toBeVisible();

      // Save authentication state
      await page.context().storageState({ path: authFile });
    });
    ```

3. Create a new `dashboard.spec.ts` file and add the following:

    ```tsx
    // tests/dashboard.spec.ts
    import { test, expect } from '@playwright/test';

    // This test runs with pre-authenticated state
    test('user can view dashboard', async ({ page }) => {
      await page.goto('/dashboard');
      // No login required - already authenticated
      await expect(page.locator('[data-testid="start-hero-intro"]')).toContainText('Woohoo!');
    });

    test('user can update profile', async ({ page }) => {
      await page.goto('/profile');

      await page.fill('[data-testid="display-name-input"]', 'Test User');
      await page.click('[data-testid="display-name-submit"]');  

      await expect(page.locator('.toast-success')).toBeVisible();
    });
    ```
4. Run the tests using the following command:
    ```bash
    npx playwright test --ui
    ```

    You should see the tests pass.

    ![Playwright saved user tests passed](https://imagedelivery.net/skPPZTHzSlcslvHjesZQcQ/67f6fda3-5f9e-4826-59f5-d8cf13d37200/public)

## Approach 2: API Testing with Token Refresh

1. Login to your test application and get the `refresh_token` cookie value. 
    
    Learn how to [obtain the refresh token](/developer-tools/testing/backend-api-testing/#step-1-obtain-initial-tokens) here.

2. Update the `.env` file with the following values:

    ```env
    # .env
    TEST_APP_URL=http://your-app-url.com
    TEST_USER_EMAIL=test@example.com
    KINDE_CLIENT_ID=your-kinde-client-id
    KINDE_ISSUER_URL=https://your-subdomain.kinde.com
    KINDE_REFRESH_TOKEN=your-refresh-token
    ```
3. Create and update a new `api.setup.ts` file with the following content:

    ```tsx
    // tests/api/api.setup.ts
    import { test as setup, expect } from '@playwright/test'
    import { writeFileSync, mkdirSync } from 'fs'
    import { join, dirname } from 'path'

    setup('refresh API tokens', async ({ request }) => {
      const response = await request.post(
        `${process.env.KINDE_ISSUER_URL}/oauth2/token`,
        {
          form: {
            client_id: process.env.KINDE_CLIENT_ID!,
            grant_type: 'refresh_token',
            refresh_token: process.env.KINDE_REFRESH_TOKEN!,
          },
        }
      )

      expect(response.ok()).toBeTruthy()
      const tokens = await response.json()

      // Store access token in a file
      const tokenPath = join(__dirname, '../../playwright/.auth/api-token.json')
      const tokenDir = dirname(tokenPath)

      // Ensure directory exists
      mkdirSync(tokenDir, { recursive: true })

      writeFileSync(
        tokenPath,
        JSON.stringify(
          {
            access_token: tokens.access_token,
            expires_at: Date.now() + tokens.expires_in * 1000,
          },
          null,
          2
        )
      )

      // Important: Update your secrets manager with the new refresh token
      // for subsequent test runs
      // const newRefreshToken = tokens.refresh_token 
    })
    ```

4. Create and update a new `users.spec.ts` file with the following content:

    ```tsx
    // tests/api/users.spec.ts
    import { test, expect } from '@playwright/test'
    import { readFileSync } from 'fs'
    import { join } from 'path'

    test.describe('API Tests', () => {
      let accessToken: string

      test.beforeAll(() => {
        // Load access token from file created by api.setup.ts
        const tokenPath = join(__dirname, '../../playwright/.auth/api-token.json')
        const tokenData = JSON.parse(readFileSync(tokenPath, 'utf-8'))
        accessToken = tokenData.access_token
      })

      test('can fetch user profile', async ({ request }) => {
        const response = await request.get('/api/profile', {
          headers: {
            Authorization: `Bearer ${accessToken}`,
          },
        })

        expect(response.ok()).toBeTruthy()

        const data = await response.json()
        expect(data.email).toBe(process.env.TEST_USER_EMAIL)
      })

      test('can update user settings', async ({ request }) => {
        const response = await request.patch('/api/settings', {
          headers: {
            Authorization: `Bearer ${accessToken}`,
          },
          data: {
            theme: 'dark',
          },
        })

        expect(response.ok()).toBeTruthy()
      })
    })
    ```
5. Update the `playwright.config.ts` file to add the following:

    ```tsx
    // playwright.config.ts
    import { defineConfig, devices } from '@playwright/test'
    import * as dotenv from 'dotenv'

    dotenv.config()

    export default defineConfig({
      testDir: './tests',
      fullyParallel: true,
      forbidOnly: !!process.env.CI,
      retries: process.env.CI ? 2 : 0,
      workers: process.env.CI ? 1 : undefined,
      reporter: 'html',

      use: {
        baseURL: process.env.TEST_APP_URL,
        trace: 'on-first-retry',
      },

      projects: [
        // Setup project - authenticates and saves state
        {
          name: 'setup',
          testMatch: /api\/.*\.setup\.ts/,
        },

        // Main tests - use saved auth state
        {
          name: 'api-tests',
          testMatch: /api\/.*\.spec\.ts/,
          dependencies: ['setup'],
        },
      ],
    })
    ```

6. Run the tests using the following command:
    ```bash
    npx playwright test --ui
    ```

    You should see the tests pass.

    ![Playwright API tests passed](https://imagedelivery.net/skPPZTHzSlcslvHjesZQcQ/76c4ced9-2be0-4220-b9e7-f7e5c362da00/public)

## Complete project structure

```
your-project/
├── playwright.config.ts
├── .env                         # Environment variables (gitignored)
├── playwright/
│   └── .auth/
│       └── user.json            # Saved auth state (gitignored)
├── tests/
│   ├── auth.setup.ts            # Authentication setup
│   ├── dashboard.spec.ts         # Tests using saved auth
│   └── api/
│       ├── api.setup.ts          # Token refresh setup
│       └── users.spec.ts         # API tests
└── package.json
```

## CI/CD integration (GitHub Actions)

```yaml
# .github/workflows/e2e-tests.yml
name: E2E Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: Run Playwright tests
        run: npx playwright test
        env:
          TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}
          TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}
          KINDE_CLIENT_ID: ${{ secrets.KINDE_CLIENT_ID }}
          KINDE_REFRESH_TOKEN: ${{ secrets.KINDE_REFRESH_TOKEN }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30
```

## Best practices

1. **Use storage state**: Save auth state once, reuse across tests for speed
2. **Isolate auth tests**: Test login flows separately with fresh browser context
3. **Use test-specific users**: Never use real user accounts
4. **Secure credentials**: Use GitHub Secrets or similar; never commit passwords
5. **Handle flakiness**: Add appropriate waits for Kinde redirects
6. **Use data-testid**: Add test IDs to your UI elements for reliable selectors
7. **Clean up**: Delete test data after test runs when possible

## Troubleshooting

### Tests fail with "Navigation timeout"

Kinde redirects can take time. Increase timeout:

```tsx
await page.waitForURL('https://your-app.com/**', { timeout: 30000 });
```

### Auth state not persisting

Ensure `playwright/.auth/` directory exists and is writable. Add to `.gitignore`.

### Token refresh fails in CI

The refresh token may have expired. Re-authenticate manually and update your CI secrets with the new refresh token.

### Kinde form selectors changed

Kinde may update the UI. Use more resilient selectors:

```tsx
// Instead of specific class names
await page.locator('input[type="email"]').fill(email);
await page.locator('input[type="password"]').fill(password);
```

## What's not supported

The following limitations apply to Playwright testing with Kinde:

- **Social provider flows**: Automated testing of Google, GitHub, or other social sign-in flows is not directly supported
- **Enterprise SSO flows**: Testing SAML/SSO enterprise connections requires coordination with identity providers
- **MFA flows**: Testing multi-factor authentication may require manual intervention