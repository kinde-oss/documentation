---
page_id: dc3c5aab-0e1e-4fb3-9a8a-8417032ee1a8
title: Test passwordless flows
description: "Guide to testing passwordless authentication flows with Playwright and Mailosaur."
sidebar:
  order: 3
topics:
  - developer-tools
  - testing
  - playwright
  - e2e-testing
  - passwordless
sdk: []
languages:
  - JavaScript
  - TypeScript
audience: developers
complexity: intermediate
keywords:
  - playwright
  - testing
  - passwordless
  - magic link
  - email OTP
  - Mailosaur
updated: 2025-01-15
featured: false
deprecated: false
---

This guide shows you how to automate passwordless authentication testing with Playwright using Mailosaur.

### What you need 

- Completed the [Playwright setup](/developer-tools/testing/playwright/)
- A [test user and application](/developer-tools/testing/setup-test-user-environment/)
- A [Mailosaur](https://mailosaur.com/) account (Sign up for free trial)

## Setup Mailosaur

1. Sign in to your Mailosaur account.
2. Copy the **Server ID** from the dashboard.
3. Go to **API Keys** > select **Create standard key** and copy the value.
4. Install the Mailosaur client in your Playwright project:

    ```bash
    npm install mailosaur --save-dev
    ```

5. Add the following to your `.env` file:

    ```env
    # ... other environment variables ...
    MAILOSAUR_API_KEY=your-api-key
    MAILOSAUR_SERVER_ID=your-server-id
    ```

    <Aside type="warning" title="Important">
      Make sure to add the `.env` file to your `.gitignore` file to prevent committing sensitive information to source control.
    </Aside>

6. Install TypeScript types for Node:

    ```bash
    npm install --save-dev @types/node
    ```

7. Create a helper utility file `tests/utils/mailosaur.ts`:

    ```bash
    mkdir -p tests/utils
    touch tests/utils/mailosaur.ts
    ```
8. Add the following code to `mailosaur.ts`:

    ```ts
    // tests/utils/mailosaur.ts
    import MailosaurClient from 'mailosaur'
    require('dotenv').config()

    const mailosaur = new MailosaurClient(process.env.MAILOSAUR_API_KEY!)
    const serverId = process.env.MAILOSAUR_SERVER_ID!

    export async function getOTPFromEmail(email: string): Promise<string> {
      const message = await mailosaur.messages.get(serverId, { sentTo: email })
      const otpMatch = message.text?.body?.match(/\b(\d{6})\b/)
      const otpCode = otpMatch?.[1]
      
      if (!otpCode) {
        throw new Error('Could not extract OTP code from email')
      }
      
      return otpCode
    }
    ```

## Test passwordless sign-up flow

To test the passwordless sign-up flow, make sure the **Email + code** option is enabled in Authentication methods in your Kinde application.

Use the following code:

    ```typescript
    // tests/passwordless-signup.spec.ts
    import { test, expect } from '@playwright/test'
    import { getOTPFromEmail } from './utils/mailosaur'
    require('dotenv').config()

    const serverId = process.env.MAILOSAUR_SERVER_ID!

    test.describe('Passwordless Authentication Flows', () => {
      test('user can sign up with email and code', async ({ page }) => {
        // Generate unique email for this test run
        const timestamp = Date.now()
        const testEmail = `test-${timestamp}@${serverId}.mailosaur.net`

        await page.goto(process.env.TEST_APP_URL!)
        await page.click('[data-testid="sign-up-button"]')

        // Wait for Kinde sign-up page
        await expect(page).toHaveURL(/kinde\.com/)

        // Fill sign-up form
        await page.fill('input[name="p_first_name"]', 'John')
        await page.fill('input[name="p_last_name"]', 'Doe')
        await page.fill('input[name="p_email"]', testEmail)
        await page.check('input[name="p_has_clickwrap_accepted"]') // Accept terms and conditions
        await page.click('button[type="submit"]')

        // Wait for OTP email and extract code
        const otpCode = await getOTPFromEmail(testEmail)

        // Enter OTP
        await page.fill('input[name="p_confirmation_code"]', otpCode)
        await page.click('button[type="submit"]')

        // Wait for successful auth
        const appUrl = new URL(process.env.TEST_APP_URL!)
        await expect(page).toHaveURL(
          new RegExp(appUrl.hostname.replace('.', '\\.'))
        )
        await expect(page.locator('[data-testid="user-profile"]')).toBeVisible()

        // Save state
        await page.context().storageState({ path: 'playwright/.auth/user.json' })
      })
    })
    ```

## Test passwordless sign-in flow

To test the passwordless sign-in flow:

1. Enable the **Email + code** option in Authentication methods. 
2. Sign up for a new test user using the Mailosaur domain (e.g, test-123@your-server-id.mailosaur.net).
3. Save the test user email to your `.env` file as `TEST_USER_EMAIL`.
4. Use the following code:

    ```ts
    // tests/passwordless-signin.spec.ts
    import { test, expect } from '@playwright/test'
    import { getOTPFromEmail } from './utils/mailosaur'
    require('dotenv').config()

    test.describe('Passwordless Authentication Flows', () => {
      test('user can sign in with email and code', async ({ page }) => {
        await page.goto(process.env.TEST_APP_URL!)
        await page.click('[data-testid="sign-in-button"]')

        // Wait for Kinde sign-in page
        await expect(page).toHaveURL(/kinde\.com/)

        // Fill sign-in form
        await page.fill('input[name="p_email"]', process.env.TEST_USER_EMAIL!)
        await page.click('button[type="submit"]')

        // Wait for OTP email and extract code
        const otpCode = await getOTPFromEmail(process.env.TEST_USER_EMAIL!)

        // Enter OTP
        await page.fill('input[name="p_confirmation_code"]', otpCode)
        await page.click('button[type="submit"]')

        // Wait for successful auth
        const appUrl = new URL(process.env.TEST_APP_URL!)
        await expect(page).toHaveURL(
          new RegExp(appUrl.hostname.replace('.', '\\.'))
        )
        await expect(page.locator('[data-testid="user-profile"]')).toBeVisible()

        // Save state
        await page.context().storageState({ path: 'playwright/.auth/user.json' })
      })
    })
    ```

## Test sign-up flow with email and password

We have included this example because OTP verification is required for all new users in Kinde regardless of the authentication method used.

This example uses the Kinde **email + password** authentication method to sign up a new test user:

```ts
// tests/email-password-signup.spec.ts
import { test, expect } from '@playwright/test'
import { getOTPFromEmail } from './utils/mailosaur'
require('dotenv').config()

const serverId = process.env.MAILOSAUR_SERVER_ID!

test.describe('Authentication Flows', () => {
  test('user can sign up with email and password', async ({ page }) => {
    // Generate unique email for this test run
    const timestamp = Date.now()
    const testEmail = `test-${timestamp}@${serverId}.mailosaur.net`

    await page.goto(process.env.TEST_APP_URL!)
    await page.click('[data-testid="sign-up-button"]')

    // Wait for Kinde sign-up page
    await expect(page).toHaveURL(/kinde\.com/)

    // Fill sign-up form
    await page.fill('input[name="p_first_name"]', 'John')
    await page.fill('input[name="p_last_name"]', 'Doe')
    await page.fill('input[name="p_email"]', testEmail)
    await page.check('input[name="p_has_clickwrap_accepted"]') // Accept terms and conditions
    await page.click('button[type="submit"]')

    // Wait for OTP email
    const otpCode = await getOTPFromEmail(testEmail)

    // Enter OTP
    await page.fill('input[name="p_confirmation_code"]', otpCode)
    await page.click('button[type="submit"]')

    // Enter password
    await page.fill(
      'input[name="p_first_password"]',
      process.env.TEST_USER_PASSWORD!
    )
    await page.fill(
      'input[name="p_second_password"]',
      process.env.TEST_USER_PASSWORD!
    )
    await page.click('button[type="submit"]')

    // Wait for successful auth
    const appUrl = new URL(process.env.TEST_APP_URL!)
    await expect(page).toHaveURL(
      new RegExp(appUrl.hostname.replace('.', '\\.'))
    )
    await expect(page.locator('[data-testid="user-profile"]')).toBeVisible()

    // Save state
    await page.context().storageState({ path: 'playwright/.auth/user.json' })
  })
})
```

## Running the tests

1. Use the following command to run the tests in UI mode:

    ```bash
    npx playwright test --ui
    ```

    You should see the test pass.

    ![user can sign up with email and code](https://imagedelivery.net/skPPZTHzSlcslvHjesZQcQ/cc2e6271-5250-4f54-5366-7135ec2dd800/socialsharingimage)

2. Go to your Kinde dashboard > **Users** to find the test users you created.

    ![Test users in Kinde dashboard](https://imagedelivery.net/skPPZTHzSlcslvHjesZQcQ/f2f25a56-d209-40ec-9bce-86932777d700/socialsharingimage)

## Best practices

1. **Use dedicated test email addresses**: Create separate email addresses for each test run to avoid conflicts
2. **Add retry logic**: Email delivery can be delayed; add polling with timeouts
3. **Clean up emails**: Delete test emails after use to keep inboxes clean
4. **Handle timeouts gracefully**: Set reasonable timeouts and provide clear error messages
5. **Extract OTP reliably**: Use regex patterns that match your OTP format (typically 6 digits)
6. **Secure credentials**: Store email service API keys in environment variables or secret managers

## What's not supported

The following limitations apply to passwordless flow testing:

- **Real email addresses**: Testing with real email addresses requires manual code entry (use test email services instead)
- **SMS OTP**: This guide focuses on email OTP; SMS OTP testing requires different approaches
- **Rate limiting**: Some email services have rate limits; plan test execution accordingly
