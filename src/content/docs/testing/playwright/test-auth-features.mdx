---
page_id: 5bfc355e-8662-41b2-94c6-0a60129bf870
title: Test authenticated features
description: "Comprehensive guide to testing authenticated features using Playwright, including reusing authentication state and CI/CD integration."
sidebar:
  order: 4
topics:
  - developer-tools
  - testing
  - playwright
  - e2e-testing
  - authenticated-testing
sdk: []
languages:
  - JavaScript
  - TypeScript
audience: developers
complexity: intermediate
keywords:
  - playwright
  - authenticated testing
  - e2e testing
  - test automation
  - CI/CD
  - authentication state
updated: 2025-01-15
featured: false
deprecated: false
---

Learn how to efficiently test authenticated features in applications using Kinde authentication with Playwright. This guide covers reusing authentication state to test protected routes and features after authentication.

Playwright supports saving and reusing browser authentication state using storage state. This is the most efficient approach for testing authenticated features. By saving the authentication state once and reusing it across tests, you can significantly speed up your test suite while maintaining test isolation.

### What you need

- Completed the [Playwright setup](/testing/playwright/)
- A [test user and application](/testing/setup-test-user-environment/)

## Setup Playwright session

1. Edit the `playwright.config.ts` file to add the following:

    ```ts
    // playwright.config.ts
    import { defineConfig, devices } from '@playwright/test';
    import * as dotenv from 'dotenv';

    dotenv.config();

    export default defineConfig({
      testDir: './tests',
      fullyParallel: true,
      forbidOnly: !!process.env.CI,
      retries: process.env.CI ? 2 : 0,
      workers: process.env.CI ? 1 : undefined,
      reporter: 'html',

      use: {
        baseURL: process.env.TEST_APP_URL,
        trace: 'on-first-retry',
      },

      projects: [
        // Setup project - authenticates and saves state
        {
          name: 'setup',
          testMatch: /.*\.setup\.ts/,
        },

        // Main tests - use saved auth state
        {
          name: 'chromium',
          use: {
            ...devices['Desktop Chrome'],
            storageState: 'playwright/.auth/user.json',
          },
          dependencies: ['setup'],
        },
      ],
    });
    ```

2. Create an `auth.setup.ts` file and add the following:

    ```ts
    // tests/auth.setup.ts
    import { test as setup, expect } from '@playwright/test';

    const authFile = 'playwright/.auth/user.json';

    setup('authenticate', async ({ page, baseURL }) => {
      // Navigate to your app's login page
      await page.goto(baseURL!);

      // Click sign in (this redirects to Kinde)
      await page.click('[data-testid="sign-in-button"]');

      // Wait for Kinde login page
      await page.waitForURL(/.*kinde\.com.*/);

      // Enter email
      await page.fill('input[name="p_email"]', process.env.TEST_USER_EMAIL!);
      await page.click('button[type="submit"]');

      // Enter password
      await page.fill('input[name="p_password"]', process.env.TEST_USER_PASSWORD!);
      await page.click('button[type="submit"]');

      // Wait for redirect back to your app
      await page.waitForURL(new RegExp(`^${baseURL}/.*`));

      // Verify authentication succeeded
      await expect(page.locator('[data-testid="user-profile"]')).toBeVisible();

      // Save authentication state
      await page.context().storageState({ path: authFile });
    });
    ```

3. Create a new `dashboard.spec.ts` file and add the following:

    ```ts
    // tests/dashboard.spec.ts
    import { test, expect } from '@playwright/test';

    // This test runs with pre-authenticated state
    test('user can view dashboard', async ({ page }) => {
      await page.goto('/dashboard');
      // No login required - already authenticated
      await expect(page.locator('[data-testid="start-hero-intro"]')).toContainText('Woohoo!');
    });

    test('user can update profile', async ({ page }) => {
      await page.goto('/profile');

      await page.fill('[data-testid="display-name-input"]', 'Test User');
      await page.click('[data-testid="display-name-submit"]');  

      await expect(page.locator('.toast-success')).toBeVisible();
    });
    ```

4. Run the tests using the following command:

    ```bash
    npx playwright test --ui
    ```

    You should see the tests pass.

    ![Playwright saved user tests passed](https://imagedelivery.net/skPPZTHzSlcslvHjesZQcQ/67f6fda3-5f9e-4826-59f5-d8cf13d37200/socialsharingimage)

## Custom session validation

You can add custom validation to ensure the session is still valid:

```ts
// tests/auth.setup.ts
import { test as setup, expect } from '@playwright/test';

const authFile = 'playwright/.auth/user.json';

setup('authenticate', async ({ page, baseURL, request }) => {
  // Authentication logic here
  await page.goto(baseURL!);
  await page.click('[data-testid="sign-in-button"]');
  // ... rest of login flow
  
  // Save authentication state
  await page.context().storageState({ path: authFile });
  
  // Validate session is still valid
  const response = await request.get(`${baseURL}/api/profile`);
  if (response.status() !== 200) {
    throw new Error('Session validation failed');
  }
});
```

## Complete project structure

```
your-project/
├── playwright.config.ts
├── .env                         # Environment variables (gitignored)
├── playwright/
│   └── .auth/
│       └── user.json            # Saved auth state (gitignored)
├── tests/
│   ├── auth.setup.ts            # Authentication setup
│   └── dashboard.spec.ts         # Tests using saved auth
└── package.json
```

## CI/CD integration (GitHub Actions)

```yaml
# .github/workflows/e2e-tests.yml
name: E2E Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: Run Playwright tests
        run: npx playwright test
        env:
          TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}
          TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}
          TEST_APP_URL: ${{ secrets.TEST_APP_URL }}

      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30
```

## Best practices

1. **Use storage state**: Save auth state once, reuse across tests for speed
2. **Isolate auth tests**: Test login flows separately with fresh browser context
3. **Use test-specific users**: Never use real user accounts
4. **Secure credentials**: Use GitHub Secrets or similar; never commit passwords
5. **Handle flakiness**: Add appropriate waits for Kinde redirects
6. **Use data-testid**: Add test IDs to your UI elements for reliable selectors
7. **Clean up**: Delete test data after test runs when possible

## Troubleshooting

### Tests fail with "Navigation timeout"

Kinde redirects can take time. Increase timeout:

```ts
await page.waitForURL('https://your-app.com/**', { timeout: 30000 });
```

### Session not persisting

Ensure `playwright/.auth/` directory exists and is writable. Add to `.gitignore`. Check Playwright configuration for storage state settings.

### Kinde form selectors changed

Kinde may update the UI. Use more resilient selectors:

```ts
// Instead of specific class names
await page.locator('input[type="email"]').fill(email);
await page.locator('input[type="password"]').fill(password);
```

## What's not supported

The following limitations apply to Playwright testing with Kinde:

- **Social provider flows**: Automated testing of Google, GitHub, or other social sign-in flows is not directly supported
- **Enterprise SSO flows**: Testing SAML/SSO enterprise connections requires coordination with identity providers
- **MFA flows**: Testing multi-factor authentication may require manual intervention
