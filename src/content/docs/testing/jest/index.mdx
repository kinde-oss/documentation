---
page_id: 94e51466-8ee6-49c6-87c8-e61c254b0756
title: Setup Jest
description: "Guide to setting up Jest for testing Kinde authentication flows."
sidebar:
  order: 1
topics:
  - developer-tools
  - testing
  - jest
  - api-testing
sdk: []
languages:
  - JavaScript
  - TypeScript
audience: developers
complexity: beginner
keywords:
  - jest
  - testing
  - setup
updated: 2025-01-15
featured: false
deprecated: false
---

Learn how to set up Jest for testing applications using Kinde authentication. This guide covers installation, configuration, and basic setup for backend API testing.

### What you need

- A [test user and application](/testing/setup-test-user-environment/).
- [Node.js](https://nodejs.org/en/download/) version 20 or higher.

## Installation

1. Install Jest and dotenv with the following command:
    ```bash
    npm install --save-dev jest dotenv
    ```

2. Create a new `.env` file in your project root:
    ```bash
    touch .env
    ```

3. Open the `.env` file and add your Kinde configuration from your test user and application.

    ```env
    # .env
    KINDE_ISSUER_URL=https://your_kinde_domain.kinde.com
    KINDE_CLIENT_ID=your_client_id
    KINDE_CLIENT_SECRET=your_client_secret
    KINDE_TEST_APP_URL=http://localhost:3000
    TEST_USER_EMAIL=your_test_user_email
    KINDE_REFRESH_TOKEN=your_refresh_token
    ```

    <Aside type="warning" title="Important">
      Make sure to add the `.env` file to your `.gitignore` file to prevent committing sensitive information to source control.
    </Aside>

## Configuration

### Jest configuration

Create or update your `package.json` file to configure Jest:

```json
{
  "scripts": {
    "test": "jest"
  },
  "jest": {
    "globalSetup": "<rootDir>/jest.global-setup.js",
    "testEnvironment": "node"
  }
}
```

### Global setup file

1. Create a `jest.global-setup.js` file:

    ```bash
    touch jest.global-setup.js
    ```

2. Open `jest.global-setup.js` and add the following code that refreshes tokens before tests run:

    ```javascript
    // jest.global-setup.js
    require('dotenv').config()

    async function refreshTokens() {
      const tokenUrl = `${process.env.KINDE_ISSUER_URL}/oauth2/token`

      try {
        const requestBody = new URLSearchParams({
          grant_type: 'refresh_token',
          client_id: process.env.KINDE_CLIENT_ID,
          client_secret: process.env.KINDE_CLIENT_SECRET,
          refresh_token: process.env.KINDE_REFRESH_TOKEN,
        }).toString()

        const response = await fetch(tokenUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: requestBody,
        })

        if (!response.ok) {
          const errorText = await response.text()
          throw new Error(
            `Token refresh failed: ${response.status} ${response.statusText} - ${errorText}`
          )
        }

        const tokens = await response.json()

        // Update environment variables for current test run
        process.env.KINDE_ACCESS_TOKEN = tokens.access_token
        process.env.KINDE_REFRESH_TOKEN = tokens.refresh_token

        console.log('✓ Tokens refreshed successfully')
      } catch (error) {
        console.warn('⚠ Failed to refresh tokens:', error.message)
        console.warn('⚠ Continuing with existing tokens from .env file')
        // Don't throw - allow tests to run with existing tokens
      }
    }

    module.exports = refreshTokens
    ```

This file will be used to refresh tokens before tests run.

## Project structure

After setup, your project should have the following structure:

```
your-project/
├── jest.global-setup.js        # Token refresh setup
├── .env                         # Environment variables (gitignored)
├── kinde-api.test.js            # Example test file
└── package.json
```

## Basic test example

Create your first test file to verify the setup:

```javascript
// kinde-api.test.js
require('dotenv').config()

describe('Kinde API Tests', () => {
  test('can fetch user profile', async () => {
    const response = await fetch(`${process.env.KINDE_TEST_APP_URL}/api/profile`, {
      headers: {
        Authorization: `Bearer ${process.env.KINDE_ACCESS_TOKEN}`,
      },
    })

    expect(response.ok).toBeTruthy()
  })
})
```

## Running tests

Run tests using the following command:

```bash
npm test
```

Or run Jest directly:

```bash
npx jest
```

## Troubleshooting

### Jest not found

If you get a "command not found" error, make sure Jest is installed:

```bash
npm install --save-dev jest
```

### Environment variables not loading

Make sure `.env` exists and contains valid environment variables. The `dotenv` package will load them automatically when you call `require('dotenv').config()`.

### Token refresh fails

Make sure your `jest.global-setup.js` file is configured correctly. See the [Test Backend APIs](/developer-tools/testing/jest/test-backend-apis/) guide for details.

## Best practices

1. **Use environment variables**: Store sensitive data in `.env` (gitignored)
2. **Organize tests**: Group related tests in separate files
3. **Use global setup**: Refresh tokens before tests run for fresh access tokens
4. **Handle async operations**: Use async/await or promises for API calls
5. **Secure credentials**: Never commit tokens to source control
